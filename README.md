# SCHS Robotics Roles Bot

A Python-based Discord bot that automates updating user roles on Sage Creek High
School's SCHS Robotics server for the following FIRST Robotics FTC teams:
*   8097 Botcats
*   9267 Level Up
*   10809 Crow Force
*   15097 Python
*   23997 Catalysts

Development is hosted at [GitHub.com/jabernat/SCHS-Robotics-Roles-Bot](
https://github.com/jabernat/SCHS-Robotics-Roles-Bot ).


## Usage

Run the bot's script for it to appear online in the server and accept chat
commands in the `#roles-bot` channel.  Once online, the bot accepts the
following commands.

**Warning**: Care must be taken not to manually update user roles during any of
these commands.

### Command `!backup`
Captures the role assignments of the server's users and responds with a
UTF8-encoded gzipped CSV file attachment structured as follows:

```csv
"Username","Display Name","Role 1 Name","Role 2 Name",…
"user_1","User One",1,0,…
"Usr2#1234","User Two",0,0,…
```

### Command `!restore`
If this command's message is accompanied by a gzipped CSV file attachment in the
same format as generated by `!backup` or `!apply`, then the bot attempts to
revert display names permissions of listed users.  Users and roles not present
in the file are not affected.

### Command `!apply`
Applies user display-name and role changes from a simplified [mentor-accessible
Google Sheet](
https://docs.google.com/spreadsheets/d/12uITMXrY9U_Utq619Asrl-UaEYbTu896KDlj-u8ckMM/edit?usp=sharing
).  Administrator users are not affected.

1.  Update the spreadsheet's "Users" tab with student names, Discord usernames,
    and active teams.
    *   Rows with missing Discord usernames are ignored.
    *   Rows with no active teams will be transitioned to alumni if the
        corresponding student was previously a team member.
    *   Rows without a first name will not result in a Discord display-name
        change.

2.  Send the `!apply` command.

3.  Before any changes, the bot responds with a pre-update backup attachment
    like the `!backup` command.

4.  The bot applies updates to non-administrators based on spreadsheet contents
    as follows:
    *   If a student's first name is provided, their display names change to
        that plus a last initial if also provided.
    *   `@Active`: Students assigned to a team gain this role, and others lose
        it.
    *   `@Alumni`: Students assigned to a team lose this role.  If a student
        leaves a team and does not join another, then they gain this role.
    *   Team roles: Students assigned to a team gain its corresponding team role
        and lose all other team roles.
    *   Team alumni roles: Students removed from a team gain its corresponding
        team alumni role.

5.  Finally, the bot's response also includes a post-update backup attachment.
